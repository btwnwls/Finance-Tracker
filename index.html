<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Finance Tracker</title>
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="manifest" href="manifest.json">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

:root {
  --bg-primary: #FFF8F0;
  --bg-secondary: #FFFFFF;
  --bg-card: #FFFBF7;
  --primary: #FF6B35;
  --secondary: #F7931E;
  --success: #10b981;
  --text-primary: #2D1810;
  --text-secondary: #8B6F47;
  --border: #FFE4D6;
  --shadow: rgba(255, 107, 53, 0.15);
  --paid-bg: #d1fae5;
  --paid-text: #065f46;
  --unpaid-bg: #fee2e2;
  --unpaid-text: #991b1b;
  --warning: #f59e0b;
  --warning-bg: #fef3c7;
  --warning-text: #92400e;
}

[data-theme="dark"] {
  --bg-primary: #1a1410;
  --bg-secondary: #2a1f1a;
  --bg-card: #332620;
  --primary: #FF8C61;
  --secondary: #FFB347;
  --text-primary: #FFF8F0;
  --text-secondary: #D4B5A0;
  --border: #4a3830;
  --shadow: rgba(0, 0, 0, 0.3);
  --paid-bg: #1a4d3a;
  --paid-text: #86efac;
  --unpaid-bg: #4a1f1f;
  --unpaid-text: #fca5a5;
  --warning: #fbbf24;
  --warning-bg: #451a03;
  --warning-text: #fde68a;
}

* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  padding: 0;
  background: var(--bg-primary);
  min-height: 100vh;
  transition: background 0.3s ease;
}

.container {
  max-width: 600px;
  margin: 0 auto;
  padding: 16px;
  padding-bottom: 80px;
}

.header {
  background: var(--bg-secondary);
  border-radius: 24px;
  padding: 28px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px var(--shadow);
  border: 2px solid var(--border);
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.header h1 {
  font-weight: 800;
  font-size: 28px;
  margin: 0;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.theme-toggle {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 2px solid var(--border);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.theme-toggle:active {
  transform: scale(0.95);
}

.greeting {
  font-size: 16px;
  color: var(--text-secondary);
  margin-bottom: 20px;
  font-weight: 500;
}

.month-selector {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin-bottom: 20px;
}

.month-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 2px solid var(--border);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.month-btn:active {
  transform: scale(0.9);
}

.current-month {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  min-width: 150px;
  text-align: center;
}

.progress-ring-container {
  display: flex;
  justify-content: center;
  margin: 24px 0;
  position: relative;
}

.progress-ring {
  transform: rotate(-90deg);
}

.progress-ring-bg {
  fill: none;
  stroke: var(--border);
  stroke-width: 12;
}

.progress-ring-progress {
  fill: none;
  stroke: url(#gradient);
  stroke-width: 12;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.5s ease;
}

.progress-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.progress-paid {
  font-size: 32px;
  font-weight: 800;
  color: var(--text-primary);
}

.progress-total {
  font-size: 14px;
  color: var(--text-secondary);
  margin-top: 4px;
}

.income-display {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 20px;
  padding: 24px;
  text-align: center;
  margin-bottom: 16px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.income-display:active {
  transform: scale(0.98);
}

.income-label {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.income-amount {
  font-size: 42px;
  font-weight: 800;
  color: white;
  margin: 8px 0;
}
.income-subtitle {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.85);
}

.breathing-room {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  border: 2px solid var(--border);
}

.breathing-label {
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.breathing-amount {
  font-size: 36px;
  font-weight: 800;
  color: var(--success);
  margin-bottom: 8px;
}

.breathing-breakdown {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  color: var(--text-secondary);
}

.trends-section {
  background: var(--bg-secondary);
  border-radius: 20px;
  padding: 24px;
  box-shadow: 0 4px 16px var(--shadow);
  margin-bottom: 20px;
  border: 2px solid var(--border);
}

.comparison-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.comparison-card {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 16px;
  border: 2px solid var(--border);
}

.comparison-label {
  font-size: 12px;
  color: var(--text-secondary);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.comparison-amount {
  font-size: 24px;
  font-weight: 800;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.comparison-change {
  font-size: 12px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 4px;
}

.comparison-change.up {
  color: var(--danger);
}

.comparison-change.down {
  color: var(--success);
}

.comparison-change.neutral {
  color: var(--text-secondary);
}

.goals-section, .bills-section, .chart-card {
  background: var(--bg-secondary);
  border-radius: 20px;
  padding: 24px;
  box-shadow: 0 4px 16px var(--shadow);
  margin-bottom: 20px;
  border: 2px solid var(--border);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.section-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
}

.btn-add {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 2px solid var(--border);
  background: var(--bg-card);
  color: var(--primary);
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  font-weight: 700;
}

.btn-add:active {
  transform: scale(0.9);
}

.goal-item {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 12px;
  border: 2px solid var(--border);
}

.goal-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.goal-info {
  flex: 1;
}

.goal-name {
  font-weight: 700;
  font-size: 16px;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.goal-target {
  font-size: 13px;
  color: var(--text-secondary);
}

.goal-amount {
  font-size: 22px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.goal-progress-bar {
  background: var(--border);
  height: 8px;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 8px;
}

.goal-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  border-radius: 10px;
  transition: width 0.5s ease;
}

.goal-stats {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--text-secondary);
}

.goal-actions {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.btn-goal {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: 2px solid var(--border);
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-goal:active {
  transform: scale(0.98);
}

.bills-filter {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  overflow-x: auto;
  padding-bottom: 4px;
}

.filter-btn {
  padding: 8px 16px;
  border-radius: 20px;
  border: 2px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s ease;
}

.filter-btn.active {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border-color: transparent;
}

.bill-item {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 12px;
  border: 2px solid var(--border);
  transition: all 0.2s ease;
  position: relative;
}

.bill-item.paid {
  opacity: 0.7;
}

.bill-item.due-soon {
  border-color: var(--warning);
  background: var(--warning-bg);
}

.bill-item:active {
  transform: scale(0.98);
}

.due-soon-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  background: var(--warning);
  color: white;
  font-size: 10px;
  font-weight: 700;
  padding: 4px 8px;
  border-radius: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.bill-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.bill-name {
  font-weight: 600;
  font-size: 16px;
  color: var(--text-primary);
  flex: 1;
}

.bill-amount {
  font-size: 18px;
  font-weight: 800;
  color: var(--primary);
  white-space: nowrap;
  margin-left: 12px;
}
.bill-details {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.bill-date {
  font-size: 13px;
  color: var(--text-secondary);
}

.category-badge, .status-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-paid {
  background: var(--paid-bg);
  color: var(--paid-text);
}

.status-unpaid {
  background: var(--unpaid-bg);
  color: var(--unpaid-text);
}

.badge-subscription {
  background: #dbeafe;
  color: #1e40af;
}

.badge-donation {
  background: #fce7f3;
  color: #9f1239;
}

.badge-entertainment {
  background: #fef3c7;
  color: #92400e;
}

.badge-gov {
  background: #e0e7ff;
  color: #3730a3;
}

.badge-loan {
  background: #fee2e2;
  color: #991b1b;
}

.badge-insurance {
  background: #d1fae5;
  color: #065f46;
}

.badge-mortgage {
  background: #f3e8ff;
  color: #6b21a8;
}

.badge-utility {
  background: #fef9c3;
  color: #854d0e;
}

.badge-transport {
  background: #ddd6fe;
  color: #5b21b6;
}

.badge-food {
  background: #fed7aa;
  color: #9a3412;
}

.bill-actions {
  display: flex;
  gap: 8px;
}

.btn-icon {
  padding: 8px 12px;
  border-radius: 10px;
  border: 2px solid var(--border);
  cursor: pointer;
  font-size: 13px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-weight: 600;
  transition: all 0.2s ease;
}

.btn-icon:active {
  transform: scale(0.95);
}

.btn-pay {
  background: var(--paid-bg);
  color: var(--paid-text);
  border-color: transparent;
}

.chart-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 16px;
}

.fab {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border: none;
  color: white;
  font-size: 28px;
  cursor: pointer;
  box-shadow: 0 8px 24px var(--shadow);
  z-index: 1000;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.fab:active {
  transform: scale(0.9);
}

.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 3000;
  display: flex;
  flex-direction: column;
  gap: 12px;
  pointer-events: none;
}

.toast {
  background: var(--bg-secondary);
  border: 2px solid var(--border);
  border-radius: 16px;
  padding: 16px 20px;
  box-shadow: 0 8px 24px var(--shadow);
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 280px;
  max-width: 400px;
  pointer-events: all;
  animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
  animation-fill-mode: forwards;
}

.toast.success {
  border-color: var(--success);
}

.toast.error {
  border-color: var(--danger);
}

.toast.info {
  border-color: var(--primary);
}

.toast-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.toast-message {
  flex: 1;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

@keyframes slideInRight {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes fadeOut {
  to {
    opacity: 0;
    transform: translateX(400px);
  }
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 2000;
  align-items: flex-end;
}

.modal.active {
  display: flex;
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

.modal-content {
  background: var(--bg-secondary);
  border-radius: 24px 24px 0 0;
  padding: 24px;
  width: 100%;
  max-width: 600px;
  margin: 0 auto;
  animation: slideUp 0.3s ease;
  max-height: 90vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-title {
  font-size: 22px;
  font-weight: 700;
  color: var(--text-primary);
}

.btn-close {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: var(--bg-card);
  color: var(--text-secondary);
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.form-input, .form-select {
  width: 100%;
  padding: 14px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 16px;
  font-family: inherit;
  color: var(--text-primary);
  background: var(--bg-card);
  transition: all 0.2s ease;
}

.form-input:focus, .form-select:focus {
  outline: none;
  border-color: var(--primary);
}

.btn-primary {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-top: 8px;
}

.btn-primary:active {
  transform: scale(0.98);
}

.btn-secondary {
  width: 100%;
  padding: 16px;
  border: 2px solid var(--border);
  border-radius: 12px;
  background: transparent;
  color: var(--text-primary);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 8px;
}

.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-secondary);
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 12px;
  opacity: 0.5;
}

.empty-text {
  font-size: 16px;
  font-weight: 600;
}
</style>
</head>
<body>
<div id="toast-container" class="toast-container"></div>
<div class="container">
  <div class="header">
    <div class="header-top">
      <h1>💰 Finance Tracker</h1>
      <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
    </div>
    <div class="greeting" id="greeting"></div>
    
    <div class="month-selector">
      <button class="month-btn" onclick="changeMonth(-1)">◀</button>
      <div class="current-month" id="current-month"></div>
      <button class="month-btn" onclick="changeMonth(1)">▶</button>
    </div>

    <div class="progress-ring-container">
      <svg class="progress-ring" width="160" height="160">
        <defs>
          <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#FF6B35"/>
            <stop offset="100%" style="stop-color:#F7931E"/>
          </linearGradient>
        </defs>
        <circle class="progress-ring-bg" cx="80" cy="80" r="70"></circle>
        <circle class="progress-ring-progress" cx="80" cy="80" r="70" id="progress-circle"></circle>
      </svg>
      <div class="progress-center">
        <div class="progress-paid" id="progress-paid">0/0</div>
        <div class="progress-total">bills paid</div>
      </div>
    </div>
  </div>

  <div class="income-display" onclick="openIncomeModal()">
    <div class="income-label">Monthly Income</div>
    <div class="income-amount" id="income-amount">£0</div>
    <div class="income-subtitle">Tap to update</div>
  </div>

  <div class="breathing-room">
    <div class="breathing-label">✨ Breathing Room</div>
    <div class="breathing-amount" id="breathing-amount">£0</div>
    <div class="breathing-breakdown">
      <span>After <span id="remaining-bills">0</span> bills</span>
      <span id="percentage-left">0%</span>
    </div>
  </div>

  <div class="trends-section">
    <div class="section-title" style="margin-bottom:16px">📈 Spending Trends</div>
    <div class="comparison-grid" id="comparison-grid"></div>
    <div class="chart-card" style="background:var(--bg-card);padding:20px;border-radius:16px;border:2px solid var(--border)">
      <div class="chart-title">Last 6 Months</div>
      <canvas id="trendsChart"></canvas>
    </div>
  </div>
<div class="goals-section">
    <div class="section-header">
      <div class="section-title">🎯 Savings Goals</div>
      <button class="btn-add" onclick="openGoalModal()">+</button>
    </div>
    <div id="goals-list"></div>
  </div>

  <div class="bills-section">
    <div class="section-header">
      <div class="section-title">📋 Bills</div>
      <button class="btn-add" onclick="openAddModal()">+</button>
    </div>
    
    <div class="bills-filter">
      <button class="filter-btn active" onclick="filterBills('all',this)">All</button>
      <button class="filter-btn" onclick="filterBills('unpaid',this)">Unpaid</button>
      <button class="filter-btn" onclick="filterBills('paid',this)">Paid</button>
    </div>
    <div id="bills-list"></div>
  </div>

  <div class="chart-card">
    <div class="chart-title">📊 Category Breakdown</div>
    <canvas id="categoryChart"></canvas>
  </div>
</div>

<button class="fab" onclick="openAddModal()">+</button>

<div class="modal" id="billModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="bill-modal-title">Add Bill</div>
      <button class="btn-close" onclick="closeModal('billModal')">×</button>
    </div>
    <form onsubmit="saveBill(event)">
      <div class="form-group">
        <label class="form-label">Bill Name</label>
        <input type="text" class="form-input" id="bill-name" required>
      </div>
      <div class="form-group">
        <label class="form-label">Amount (£)</label>
        <input type="number" class="form-input" id="bill-amount" step="0.01" min="0" required>
      </div>
      <div class="form-group">
        <label class="form-label">Due Date</label>
        <input type="number" class="form-input" id="bill-due-day" placeholder="Day of month (1-31)" min="1" max="31" required>
      </div>
      <div class="form-group">
        <label class="form-label">Category</label>
        <select class="form-select" id="bill-category" required>
          <option value="">Select</option>
          <option value="Subscription">Subscription</option>
          <option value="Utility">Utility</option>
          <option value="Transport">Transport</option>
          <option value="Mortgage">Mortgage</option>
          <option value="Insurance">Insurance</option>
          <option value="Loan">Loan</option>
          <option value="Gov">Government</option>
          <option value="Food">Food</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Donation">Donation</option>
        </select>
      </div>
      <button type="submit" class="btn-primary" id="bill-submit-btn">Add Bill</button>
      <button type="button" class="btn-secondary" onclick="closeModal('billModal')">Cancel</button>
    </form>
  </div>
</div>

<div class="modal" id="incomeModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Set Monthly Income</div>
      <button class="btn-close" onclick="closeModal('incomeModal')">×</button>
    </div>
    <form onsubmit="saveIncome(event)">
      <div class="form-group">
        <label class="form-label">Monthly Income (£)</label>
        <input type="number" class="form-input" id="income-input" step="0.01" min="0" required>
      </div>
      <button type="submit" class="btn-primary">Save</button>
      <button type="button" class="btn-secondary" onclick="closeModal('incomeModal')">Cancel</button>
    </form>
  </div>
</div>

<div class="modal" id="goalModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="goal-modal-title">Add Goal</div>
      <button class="btn-close" onclick="closeModal('goalModal')">×</button>
    </div>
    <form onsubmit="saveGoal(event)">
      <div class="form-group">
        <label class="form-label">Goal Name</label>
        <input type="text" class="form-input" id="goal-name" required>
      </div>
      <div class="form-group">
        <label class="form-label">Target Amount (£)</label>
        <input type="number" class="form-input" id="goal-target" step="0.01" min="0" required>
      </div>
      <div class="form-group">
        <label class="form-label">Current Amount (£)</label>
        <input type="number" class="form-input" id="goal-current" step="0.01" min="0" value="0" required>
      </div>
      <div class="form-group">
        <label class="form-label">Target Date</label>
        <input type="date" class="form-input" id="goal-date" required>
      </div>
      <button type="submit" class="btn-primary" id="goal-submit-btn">Add Goal</button>
      <button type="button" class="btn-secondary" onclick="closeModal('goalModal')">Cancel</button>
    </form>
  </div>
</div>

<div class="modal" id="addMoneyModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Add Money</div>
      <button class="btn-close" onclick="closeModal('addMoneyModal')">×</button>
    </div>
    <form onsubmit="addMoney(event)">
      <div class="form-group">
        <label class="form-label">Amount (£)</label>
        <input type="number" class="form-input" id="money-amount" step="0.01" min="0.01" required>
      </div>
      <button type="submit" class="btn-primary">Add</button>
      <button type="button" class="btn-secondary" onclick="closeModal('addMoneyModal')">Cancel</button>
    </form>
  </div>
</div>

<script>
const KEY='finance_v2';
const defaultBills=[
{id:1,name:'Netflix',amount:15.99,dueDay:15,category:'Subscription'},
{id:2,name:'Spotify',amount:11.99,dueDay:1,category:'Subscription'},
{id:3,name:'Amazon Prime',amount:8.99,dueDay:5,category:'Subscription'},
{id:4,name:'Electricity',amount:165.54,dueDay:10,category:'Utility'},
{id:5,name:'Water',amount:43.47,dueDay:15,category:'Utility'},
{id:6,name:'Internet',amount:32.99,dueDay:20,category:'Utility'},
{id:7,name:'Phone',amount:45,dueDay:25,category:'Utility'},
{id:8,name:'Mortgage',amount:1199.87,dueDay:1,category:'Mortgage'},
{id:9,name:'Council Tax',amount:173,dueDay:28,category:'Gov'},
{id:10,name:'Car Insurance',amount:74.96,dueDay:12,category:'Insurance'},
{id:11,name:'Train Pass',amount:172.8,dueDay:1,category:'Transport'},
{id:12,name:'Groceries',amount:350,dueDay:7,category:'Food'}
];

let state={bills:[],goals:[],income:0,currentMonth:new Date(),paymentStatus:{},theme:'light',spendingHistory:{}};
let chart,trendsChart,editingBillId,editingGoalId,addMoneyGoalId,currentFilter='all';

function showToast(message,type='success'){
const container=document.getElementById('toast-container');
const toast=document.createElement('div');
toast.className=`toast ${type}`;
const icons={success:'✓',error:'✗',info:'ℹ'};
toast.innerHTML=`<div class="toast-icon">${icons[type]||icons.success}</div><div class="toast-message">${message}</div>`;
container.appendChild(toast);
setTimeout(()=>toast.remove(),3000);
}

function load(){
const s=localStorage.getItem(KEY);
if(s){
const d=JSON.parse(s);
state={...state,...d,currentMonth:new Date()};
if(!state.bills.length)state.bills=defaultBills.map((b,i)=>({...b,id:Date.now()+i}));
if(!state.spendingHistory)state.spendingHistory={};
}else{
state.bills=defaultBills.map((b,i)=>({...b,id:Date.now()+i}));
}
document.documentElement.setAttribute('data-theme',state.theme);
updateThemeIcon();
}

function save(){
localStorage.setItem(KEY,JSON.stringify(state));
updateSpendingHistory();
}

function updateSpendingHistory(){
const k=getMonthKey();
const total=state.bills.reduce((s,b)=>s+b.amount,0);
if(!state.spendingHistory)state.spendingHistory={};
state.spendingHistory[k]=total;
}

function toggleTheme(){
state.theme=state.theme==='light'?'dark':'light';
document.documentElement.setAttribute('data-theme',state.theme);
updateThemeIcon();
save();
if(chart)updateChart();
if(trendsChart)updateTrendsChart();
showToast('Theme changed','info');
}

function updateThemeIcon(){
document.querySelector('.theme-toggle').textContent=state.theme==='dark'?'☀️':'🌙';
}

function getMonthKey(d=state.currentMonth){
return`${d.getFullYear()}-${d.getMonth()}`;
}

function changeMonth(dir){
state.currentMonth=new Date(state.currentMonth.getFullYear(),state.currentMonth.getMonth()+dir);
render();
}

function getGreeting(){
const h=new Date().getHours();
return h<12?'Good morning! Here\'s your overview':h<18?'Good afternoon! Here\'s your overview':'Good evening! Here\'s your overview';
}

function isDueSoon(dueDay){
const today=new Date().getDate();
const daysUntil=dueDay-today;
return daysUntil>=0&&daysUntil<=3;
}

function updateProgressRing(){
const k=getMonthKey();
const paid=state.bills.filter(b=>state.paymentStatus[k]?.[b.id]).length;
const total=state.bills.length;
const pct=total?paid/total:0;
const c=document.getElementById('progress-circle');
const r=70,circ=2*Math.PI*r;
c.style.strokeDasharray=`${circ} ${circ}`;
c.style.strokeDashoffset=circ*(1-pct);
document.getElementById('progress-paid').textContent=`${paid}/${total}`;
}

function calcBreathingRoom(){
const k=getMonthKey();
const unpaid=state.bills.filter(b=>!state.paymentStatus[k]?.[b.id]);
const total=unpaid.reduce((s,b)=>s+b.amount,0);
const breath=state.income-total;
const pct=state.income?(breath/state.income*100).toFixed(0):0;
document.getElementById('breathing-amount').textContent='£'+breath.toFixed(2);
document.getElementById('remaining-bills').textContent=unpaid.length;
document.getElementById('percentage-left').textContent=pct+'% left';
}
function toggleBillPaid(id){
const k=getMonthKey();
if(!state.paymentStatus[k])state.paymentStatus[k]={};
state.paymentStatus[k][id]=!state.paymentStatus[k][id];
const bill=state.bills.find(b=>b.id===id);
const isPaid=state.paymentStatus[k][id];
showToast(isPaid?`${bill.name} marked as paid`:`${bill.name} marked as unpaid`,isPaid?'success':'info');
save();
render();
}

function filterBills(f,btn){
currentFilter=f;
document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
renderBills();
}

function renderBills(){
const list=document.getElementById('bills-list');
const k=getMonthKey();
let filtered=state.bills;
if(currentFilter==='paid')filtered=state.bills.filter(b=>state.paymentStatus[k]?.[b.id]);
else if(currentFilter==='unpaid')filtered=state.bills.filter(b=>!state.paymentStatus[k]?.[b.id]);
if(!filtered.length){
list.innerHTML='<div class="empty-state"><div class="empty-icon">📭</div><div class="empty-text">No bills here</div></div>';
return;
}
list.innerHTML=filtered.map(b=>{
const isPaid=state.paymentStatus[k]?.[b.id];
const dueSoon=!isPaid&&isDueSoon(b.dueDay);
return`<div class="bill-item ${isPaid?'paid':''} ${dueSoon?'due-soon':''}">
${dueSoon?'<div class="due-soon-badge">Due Soon</div>':''}
<div class="bill-header">
<div class="bill-name">${b.name}</div>
<div class="bill-amount">£${b.amount.toFixed(2)}</div>
</div>
<div class="bill-details">
<div class="bill-date">Due: ${b.dueDay}${getDaySuffix(b.dueDay)}</div>
<span class="category-badge badge-${b.category.toLowerCase()}">${b.category}</span>
<span class="status-badge status-${isPaid?'paid':'unpaid'}">${isPaid?'Paid':'Unpaid'}</span>
</div>
<div class="bill-actions">
<button class="btn-icon ${isPaid?'':'btn-pay'}" onclick="toggleBillPaid(${b.id})">${isPaid?'Unpay':'Pay'}</button>
<button class="btn-icon" onclick="editBill(${b.id})">Edit</button>
<button class="btn-icon" onclick="deleteBill(${b.id})">Delete</button>
</div>
</div>`}).join('');
}

function getDaySuffix(day){
if(day>3&&day<21)return'th';
switch(day%10){
case 1:return'st';
case 2:return'nd';
case 3:return'rd';
default:return'th';
}
}

function renderGoals(){
const list=document.getElementById('goals-list');
if(!state.goals.length){
list.innerHTML='<div class="empty-state"><div class="empty-icon">🎯</div><div class="empty-text">No goals yet</div></div>';
return;
}
list.innerHTML=state.goals.map(g=>{
const pct=Math.min((g.current/g.target*100),100).toFixed(0);
const date=new Date(g.date);
const days=Math.ceil((date-new Date())/(1000*60*60*24));
const months=Math.ceil(days/30);
return`<div class="goal-item">
<div class="goal-header">
<div class="goal-info">
<div class="goal-name">${g.name}</div>
<div class="goal-target">Target: £${g.target.toFixed(2)} by ${date.toLocaleDateString()}</div>
</div>
<div class="goal-amount">£${g.current.toFixed(2)}</div>
</div>
<div class="goal-progress-bar">
<div class="goal-progress-fill" style="width:${pct}%"></div>
</div>
<div class="goal-stats">
<span>${pct}% complete</span>
<span>${days>0?`${months} months left`:'Target passed'}</span>
</div>
<div class="goal-actions">
<button class="btn-goal" onclick="openAddMoney(${g.id})">Add Money</button>
<button class="btn-goal" onclick="editGoal(${g.id})">Edit</button>
<button class="btn-goal" onclick="deleteGoal(${g.id})">Delete</button>
</div>
</div>`}).join('');
}

function updateComparison(){
const grid=document.getElementById('comparison-grid');
const thisMonth=getMonthKey();
const lastMonthDate=new Date(state.currentMonth.getFullYear(),state.currentMonth.getMonth()-1);
const lastMonth=getMonthKey(lastMonthDate);
const thisTotal=state.spendingHistory[thisMonth]||state.bills.reduce((s,b)=>s+b.amount,0);
const lastTotal=state.spendingHistory[lastMonth]||0;
const change=lastTotal>0?((thisTotal-lastTotal)/lastTotal*100).toFixed(1):0;
const changeClass=change>0?'up':change<0?'down':'neutral';
const changeIcon=change>0?'↑':change<0?'↓':'→';
grid.innerHTML=`
<div class="comparison-card">
<div class="comparison-label">This Month</div>
<div class="comparison-amount">£${thisTotal.toFixed(2)}</div>
<div class="comparison-change ${changeClass}">${changeIcon} ${Math.abs(change)}%</div>
</div>
<div class="comparison-card">
<div class="comparison-label">Last Month</div>
<div class="comparison-amount">£${lastTotal.toFixed(2)}</div>
<div class="comparison-change neutral">Previous period</div>
</div>
`;
}

function updateTrendsChart(){
const ctx=document.getElementById('trendsChart');
if(!ctx)return;
const months=[];
const data=[];
for(let i=5;i>=0;i--){
const d=new Date(state.currentMonth.getFullYear(),state.currentMonth.getMonth()-i);
const key=getMonthKey(d);
const monthName=d.toLocaleDateString('en-US',{month:'short',year:'numeric'});
months.push(monthName);
data.push(state.spendingHistory[key]||0);
}
if(trendsChart)trendsChart.destroy();
trendsChart=new Chart(ctx,{
type:'line',
data:{
labels:months,
datasets:[{
label:'Total Spending',
data:data,
borderColor:getComputedStyle(document.documentElement).getPropertyValue('--primary'),
backgroundColor:getComputedStyle(document.documentElement).getPropertyValue('--primary')+'20',
borderWidth:3,
fill:true,
tension:0.4,
pointRadius:6,
pointBackgroundColor:getComputedStyle(document.documentElement).getPropertyValue('--primary'),
pointBorderColor:'#fff',
pointBorderWidth:2
}]
},
options:{
responsive:true,
maintainAspectRatio:true,
plugins:{
legend:{display:false},
tooltip:{
backgroundColor:getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
padding:12,
callbacks:{
label:function(context){
return`£${context.parsed.y.toFixed(2)}`;
}
}
}
},
scales:{
y:{
beginAtZero:true,
grid:{color:getComputedStyle(document.documentElement).getPropertyValue('--border')},
ticks:{
color:getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),
callback:function(value){return'£'+value}
}
},
x:{
grid:{display:false},
ticks:{color:getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')}
}
}
}
});
}

function updateChart(){
const ctx=document.getElementById('categoryChart');
if(!ctx)return;
const cats={};
state.bills.forEach(b=>{cats[b.category]=(cats[b.category]||0)+b.amount});
const labels=Object.keys(cats);
const data=Object.values(cats);
const colors=['#a78bfa','#fbbf24','#c084fc','#60a5fa','#f472b6','#34d399','#fb923c','#f87171'];
if(chart)chart.destroy();
chart=new Chart(ctx,{
type:'doughnut',
data:{labels,datasets:[{data,backgroundColor:colors,borderWidth:2,borderColor:getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary')}]},
options:{
responsive:true,
plugins:{
legend:{position:'bottom',labels:{padding:12,font:{size:11,family:'Inter',weight:'600'},color:getComputedStyle(document.documentElement).getPropertyValue('--text-primary')}},
tooltip:{
backgroundColor:getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
padding:12,
callbacks:{
label:function(context){
const label=context.label||'';
const value=context.parsed||0;
const total=context.dataset.data.reduce((a,b)=>a+b,0);
const percentage=total>0?((value/total)*100).toFixed(1):0;
return`${label}: £${value.toFixed(2)} (${percentage}%)`;
}
}
}
}
}
});
}

function render(){
const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
document.getElementById('current-month').textContent=`${months[state.currentMonth.getMonth()]} ${state.currentMonth.getFullYear()}`;
document.getElementById('greeting').textContent=getGreeting();
document.getElementById('income-amount').textContent='£'+state.income.toFixed(2);
updateProgressRing();
calcBreathingRoom();
updateComparison();
updateTrendsChart();
renderBills();
renderGoals();
updateChart();
}

function openAddModal(){
editingBillId=null;
document.getElementById('bill-modal-title').textContent='Add Bill';
document.getElementById('bill-submit-btn').textContent='Add Bill';
document.getElementById('bill-name').value='';
document.getElementById('bill-amount').value='';
document.getElementById('bill-due-day').value='';
document.getElementById('bill-category').value='';
document.getElementById('billModal').classList.add('active');
}

function editBill(id){
const bill=state.bills.find(b=>b.id===id);
if(!bill)return;
editingBillId=id;
document.getElementById('bill-modal-title').textContent='Edit Bill';
document.getElementById('bill-submit-btn').textContent='Save Changes';
document.getElementById('bill-name').value=bill.name;
document.getElementById('bill-amount').value=bill.amount;
document.getElementById('bill-due-day').value=bill.dueDay;
document.getElementById('bill-category').value=bill.category;
document.getElementById('billModal').classList.add('active');
}

function deleteBill(id){
if(confirm('Delete this bill?')){
const bill=state.bills.find(b=>b.id===id);
state.bills=state.bills.filter(b=>b.id!==id);
showToast(`${bill.name} deleted`,'info');
save();
render();
}
}
function saveBill(event){
event.preventDefault();
const name=document.getElementById('bill-name').value;
const amount=parseFloat(document.getElementById('bill-amount').value);
const dueDay=parseInt(document.getElementById('bill-due-day').value);
const category=document.getElementById('bill-category').value;
if(editingBillId){
const bill=state.bills.find(b=>b.id===editingBillId);
if(bill){
bill.name=name;
bill.amount=amount;
bill.dueDay=dueDay;
bill.category=category;
showToast(`${name} updated`,'success');
}
}else{
const newId=state.bills.length>0?Math.max(...state.bills.map(b=>b.id))+1:1;
state.bills.push({id:newId,name,amount,dueDay,category});
showToast(`${name} added`,'success');
}
save();
closeModal('billModal');
render();
}

function openIncomeModal(){
document.getElementById('income-input').value=state.income||'';
document.getElementById('incomeModal').classList.add('active');
}

function saveIncome(event){
event.preventDefault();
const oldIncome=state.income;
state.income=parseFloat(document.getElementById('income-input').value);
showToast(`Income ${oldIncome>0?'updated':'set'} to £${state.income.toFixed(2)}`,'success');
save();
closeModal('incomeModal');
render();
}

function openGoalModal(){
editingGoalId=null;
document.getElementById('goal-modal-title').textContent='Add Goal';
document.getElementById('goal-submit-btn').textContent='Add Goal';
document.getElementById('goal-name').value='';
document.getElementById('goal-target').value='';
document.getElementById('goal-current').value='0';
document.getElementById('goal-date').value='';
document.getElementById('goalModal').classList.add('active');
}

function editGoal(id){
const goal=state.goals.find(g=>g.id===id);
if(!goal)return;
editingGoalId=id;
document.getElementById('goal-modal-title').textContent='Edit Goal';
document.getElementById('goal-submit-btn').textContent='Save Changes';
document.getElementById('goal-name').value=goal.name;
document.getElementById('goal-target').value=goal.target;
document.getElementById('goal-current').value=goal.current;
document.getElementById('goal-date').value=goal.date;
document.getElementById('goalModal').classList.add('active');
}

function deleteGoal(id){
if(confirm('Delete this goal?')){
const goal=state.goals.find(g=>g.id===id);
state.goals=state.goals.filter(g=>g.id!==id);
showToast(`${goal.name} deleted`,'info');
save();
render();
}
}

function saveGoal(event){
event.preventDefault();
const name=document.getElementById('goal-name').value;
const target=parseFloat(document.getElementById('goal-target').value);
const current=parseFloat(document.getElementById('goal-current').value);
const date=document.getElementById('goal-date').value;
if(editingGoalId){
const goal=state.goals.find(g=>g.id===editingGoalId);
if(goal){
goal.name=name;
goal.target=target;
goal.current=current;
goal.date=date;
showToast(`${name} updated`,'success');
}
}else{
const newId=state.goals.length>0?Math.max(...state.goals.map(g=>g.id))+1:1;
state.goals.push({id:newId,name,target,current,date});
showToast(`${name} goal created`,'success');
}
save();
closeModal('goalModal');
render();
}

function openAddMoney(goalId){
addMoneyGoalId=goalId;
document.getElementById('money-amount').value='';
document.getElementById('addMoneyModal').classList.add('active');
}

function addMoney(event){
event.preventDefault();
const amount=parseFloat(document.getElementById('money-amount').value);
const goal=state.goals.find(g=>g.id===addMoneyGoalId);
if(goal){
goal.current+=amount;
const pct=Math.min((goal.current/goal.target*100),100).toFixed(0);
if(pct>=100){
showToast(`🎉 Goal "${goal.name}" reached!`,'success');
}else{
showToast(`£${amount.toFixed(2)} added to ${goal.name}`,'success');
}
save();
closeModal('addMoneyModal');
render();
}
}

function closeModal(id){
document.getElementById(id).classList.remove('active');
}

document.querySelectorAll('.modal').forEach(modal=>{
modal.addEventListener('click',function(e){
if(e.target===this){
closeModal(this.id);
}
});
});

load();
render();
</script>
</body>
</html>
